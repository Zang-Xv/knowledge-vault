# 终端配置

我以往一直觉得终端配置没有什么特别的必要, 具有更多图像化可操控界面的现代 IDE 也挺不错的, 功能高度集成不是挺好吗?
但是我因为长时间的伏案导致腰背和手腕手臂的各种问题, 我开始减少鼠标的使用
另外一个原因是因为我逐渐接触到远程开发, 初衷是因为我随身携带的机子配置没有宿舍常驻的电脑那么好用, 尝试使用 ssh 远程连接自己的电脑来进行远程的开发, 而且使用服务器的时候也常常没有办法使用图像化界面
console 界面的熟悉是必然的

## terminal Emulator

首先需要说明的是我一直一来的一个误区, 这可能导致我在搜寻很多信息的时候无果或者被误导
terminal 可以说是一个终端模拟器, 是我们常用的终端的外壳, 外在前端, 一个负责显示文本、接收键盘输入的程序
而我们使用的命令, 以及各种指令什么的, 取决于其内核 shell

可配置内容（外观 & 交互）:

- 字体（Nerd Font）
- 配色方案
- 透明度 / 模糊
- Tab / Pane
- 快捷键
- JSON 配置（Windows Terminal）

### win11 自带

其实 win11 自带的终端功能已经不错了, 可以快速打开不同的 shell, 还支持分页什么的

### hyper terminal

这是一个高度可定制化的终端, 可以通过各种插件修改外端表现

## shell

shell 还涉及一些 MSYS2 POSIX 之类的东西, 大概类似于shell 的运行环境的样子?

这才是决定使用效果的大头, 如果我想要做更好的自动补全, 或者命令提示的话, 仰赖的应该都是 shell 的环境
负责：

- 解析命令
- 查找可执行文件
- 调用系统 API
- 控制管道、重定向、变量、脚本

可配置内容（效率 & 能力）:

- Prompt（如 oh-my-posh）
- 自动补全
- Alias / Function
- 历史搜索
- 脚本能力

不用太“重”的美化框架

用：
bash-completion
conda hook
简单 prompt
👉 跨机器、跨发行版更稳

### cmd.exe（传统）

### PowerShell / pwsh

### bash（WSL / Git Bash）

这个 ble.sh 似乎就是我想要的东西了，只是加载上可能有一点点慢了

```bash
# DOWNLOAD with curl
curl -LO https://github.com/akinomyoga/ble.sh/releases/download/v0.4.0-devel3/ble-0.4.0-devel3.tar.xz

# TRIAL
tar xJf ble-0.4.0-devel3.tar.xz
source ble-0.4.0-devel3/ble.sh

# INSTALL (quick)
tar xJf ble-0.4.0-devel3.tar.xz -C ~/.local/share/blesh
echo 'source ~/.local/share/blesh' >> ~/.bashrc

# INSTALL (more robust)
tar xJf ble-0.4.0-devel3.tar.xz -C ~/.local/share/blesh
# Add the following line near the top of ~/.bashrc
[[ $- == *i* ]] && source ~/.local/share/blesh/ble.sh --attach=none
# Add the following line at the end of ~/.bashrc
[[ ${BLE_VERSION-} ]] && ble-attach
```

推荐使用第三种方式加载这个脚本，因为我还有conda等等其他东西，可能会出现渲染问题，最好是加载之后手动开启
但是开启 ble 之后会有一些字符渲染缓慢的问题，所以可以干脆把最后一行也删除，需要使用的时候手动`ble-attach`

### zsh（WSL）

### fsh

## command line

## tty（getty）

## tool

这是 shell 可以调用的工具
starship / fzf / tmux 等

### oh my posh

shell 在生成 prompt 时，主动调用一个外部程序
oh-my-posh 是一个运行在 shell 进程中、
但在 terminal 显示之前 负责生成 prompt 字符串的“外置渲染器”。

它对不同平台的各种终端都有适配，可以作为一个统一的样式模板来使用

#### 安装和配置

[oh-my-posh文档](https://ohmyposh.dev/docs/installation/windows)

##### 一、安装

如果没装 oh-my-posh，可在 PowerShell 或 cmd 中执行：
`winget install JanDeDobbeleer.OhMyPosh -s winget`

> git bash 中可能会没法运行 winget, 我第一次执行的时候提示这不是个命令, 使用 cmd 安装完之后又可以 winget 了, 非常奇怪

Git Bash 中可以直接执行 oh-my-posh.exe，注意路径加入 PATH。

##### 二、创建主题配置（theme / dotfile）

新建一个主题文件，例如 ~/.poshthemes/mytheme.omp.json

路径可以放在 ~/.poshthemes 或你 dotfiles 仓库里统一管理

内容示例：

```json
{
  "blocks": [
    {
      "type": "prompt",
      "alignment": "left",
      "segments": [
        {
          "type": "path",
          "style": "powerline"
        },
        {
          "type": "git",
          "style": "powerline"
        }
      ]
    }
  ]
}
```

测试并预览主题：

`oh-my-posh print primary --config ~/.posh/win_bash_theme.json --shell uni`

你会看到 prompt 被渲染

##### 三、字体选择与下载(可选)

posh 只能配置使用什么字体渲染, 但是首先要下载字体并对终端进行对应的配置, 不然的话 NF 当中的符号会被显示成 
当然也可能是因为我加载的是预设的 theme 的缘故

使用 Visual Studio Code 时，您还需要配置集成终端以使用 Nerd 字体。这可以通过更改终端设置中的 Integrated: Font Family 值来完成

安装好 Nerd 字体后，您需要配置 Windows 终端以使用它。这可以通过修改 Windows 终端设置轻松完成（默认快捷键： CTRL + SHIFT + , ）。在您的 settings.json 文件中添加以下内容： profiles 中 defaults 属性下的 font.face 属性：

###### 字体选择的重要特性和缘由

**等宽一致性（monospace consistency）:**
终端的核心假设是：每个字符占用相同的 cell 宽度
问题在于：

- ASCII 字符：1 cell
- 中文字符：逻辑上是 2 cells
- emoji / nerd icon：2 cells 或不确定

如果字体在这三者之间 宽度定义不一致，你会看到：

- 光标跳动
- powerline 断裂
- 表格错位
- git log 对不齐

**fallback 行为是否“可控”:**

终端渲染流程是：

- 当前字体有 glyph？ → 用它
- 没有 → fallback 到系统字体

关键问题是：

- fallback 字体是否也是等宽？
- fallback 字体字重是否接近？
- 行高是否一致？

###### 字体推荐

许多地方会推荐 JetBrains Mono
而 posh 推荐的是 meslo
JetBrains Mono 的特点是：

- JetBrains Mono 对 ASCII / 符号的 cell 定义非常严格, 这点是它被选中的第一原因。
- 不包含 CJK glyph, 明确“我只负责西文”

Meslo LGM NF 是什么来头？
Meslo LGM = Meslo + Line Gap Modified
它的设计背景：
原始字体：Menlo
Menlo 是：
macOS Terminal 默认字体
稳定、等宽、渲染一致
Meslo 在 Menlo 基础上：
调整了 line gap
加了 powerline glyph
Nerd Font 化

👉 这意味着：
在 macOS / Linux / Windows 上，
Meslo 的“行高 + glyph 对齐”极其稳定

这里姑且先使用 posh 的推荐, 后续再来折腾调整字体问题

##### 四、让 Git Bash 自动加载 oh-my-posh

编辑 Git Bash 启动脚本 ~/.bashrc（或 ~/.bash_profile）, 加入下列语句：

```bash
eval "$(oh-my-posh init bash --config ~/.posh/win_bash_theme.json)"
```

如果不知道使用的是哪一个 shell, posh 甚至有个小工具可以查询 `oh-my-posh get shell`
保存后，`exec bash`重新启动 Git Bash 就会自动加载。

##### 五、把配置加入 dotfiles 仓库

在本地创建 dotfiles 仓库：

```bash
mkdir ~/dotfiles
cd ~/dotfiles
git init
```

复制配置文件：

```bash
mkdir posh
cp ~/.posh/win_bash_theme.json posh/
```

添加 Git Bash 初始化脚本：

```bash
cp ~/.bashrc bashrc
```

注意：不要直接把 .bashrc 放在根目录，否则 Windows 和 Linux 可能冲突

可用 bashrc 或 bash/.bashrc 形式管理

提交并推送到 GitHub：

```bash
git add .
git commit -m "Add oh-my-posh theme for Git Bash"
git remote add origin https://github.com/<你的用户名>/dotfiles.git
git push -u origin main
```

##### 六、在其他机器上使用

克隆 dotfiles: `git clone https://github.com/<你的用户名>/dotfiles.git ~/dotfiles`

创建软链接到 Git Bash 的配置文件：

ln -s ~/dotfiles/bashrc ~/.bashrc
ln -s ~/dotfiles/posh/mytheme.omp.json ~/.poshthemes/mytheme.omp.json

安装 oh-my-posh（如果还没安装）

重新启动 Git Bash，prompt 就和 A 机一致了

六、跨端管理注意事项

路径差异

Windows 路径：C:\Users\xxx\ → Git Bash 会解析为 /c/Users/xxx/

Linux 路径：~/.poshthemes/...

建议使用 ~ 统一

工具版本

确保各端 oh-my-posh 版本一致，否则渲染效果可能不同

字体和 Nerd Font

posh 使用图标需要安装 Nerd Font

确保各端 terminal 都设置成同样字体
